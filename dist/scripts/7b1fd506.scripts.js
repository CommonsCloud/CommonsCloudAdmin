!function(a){function b(a,b,c){return a>b&&b+c>a}function c(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}a.widget("ui.sortable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===a.axis||c(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){"disabled"===b?(this.options[b]=c,this.widget().toggleClass("ui-sortable-disabled",!!c)):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=null,e=!1,f=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(b),a(b.target).parents().each(function(){return a.data(this,f.widgetName+"-item")===f?(d=a(this),!1):void 0}),a.data(b.target,f.widgetName+"-item")===f&&(d=a(b.target)),d&&(!this.options.handle||c||(a(this.options.handle,d).find("*").addBack().each(function(){this===b.target&&(e=!0)}),e))?(this.currentItem=d,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(b,c,d){var e,f,g=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),g.containment&&this._setContainment(),g.cursor&&"auto"!==g.cursor&&(f=this.document.find("body"),this.storedCursor=f.css("cursor"),f.css("cursor",g.cursor),this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(f)),g.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",g.opacity)),g.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",g.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var c,d,e,f,g=this.options,h=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+g.scrollSpeed:b.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-g.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+g.scrollSpeed:b.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-g.scrollSpeed)):(b.pageY-a(document).scrollTop()<g.scrollSensitivity?h=a(document).scrollTop(a(document).scrollTop()-g.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<g.scrollSensitivity&&(h=a(document).scrollTop(a(document).scrollTop()+g.scrollSpeed)),b.pageX-a(document).scrollLeft()<g.scrollSensitivity?h=a(document).scrollLeft(a(document).scrollLeft()-g.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<g.scrollSensitivity&&(h=a(document).scrollLeft(a(document).scrollLeft()+g.scrollSpeed))),h!==!1&&a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=d.item[0],f=this._intersectsWithPointer(d),f&&d.instance===this.currentContainer&&e!==this.currentItem[0]&&this.placeholder[1===f?"next":"prev"]()[0]!==e&&!a.contains(this.placeholder[0],e)&&("semi-dynamic"===this.options.type?!a.contains(this.element[0],e):!0)){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d))break;this._rearrange(b,d),this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset(),f=this.options.axis,g={};f&&"x"!==f||(g.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),f&&"y"!==f||(g.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l="x"===this.options.axis||d+j>h&&i>d+j,m="y"===this.options.axis||b+k>f&&g>b+k,n=l&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?n:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(a){var c="x"===this.options.axis||b(this.positionAbs.top+this.offset.click.top,a.top,a.height),d="y"===this.options.axis||b(this.positionAbs.left+this.offset.click.left,a.left,a.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&"right"===g||"down"===f?2:1:f&&("down"===f?2:1):!1},_intersectsWithSides:function(a){var c=b(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),d=b(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?"right"===f&&d||"left"===f&&!d:e&&("down"===e&&c||"up"===e&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){function c(){h.push(this)}var d,e,f,g,h=[],i=[],j=this._connectWith();if(j&&b)for(d=j.length-1;d>=0;d--)for(f=a(j[d]),e=f.length-1;e>=0;e--)g=a.data(f[e],this.widgetFullName),g&&g!==this&&!g.options.disabled&&i.push([a.isFunction(g.options.items)?g.options.items.call(g.element):a(g.options.items,g.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),g]);for(i.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),d=i.length-1;d>=0;d--)i[d][0].each(c);return a(h)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c,d,e,f,g,h,i,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(c=m.length-1;c>=0;c--)for(e=a(m[c]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&(l.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],b,{item:this.currentItem}):a(f.options.items,f.element),f]),this.containers.push(f));for(c=l.length-1;c>=0;c--)for(g=l[c][1],h=l[c][0],d=0,j=h.length;j>d;d++)i=a(h[d]),i.data(this.widgetName+"-item",g),k.push({item:i,instance:g,width:0,height:0,left:0,top:0})},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var c,d,e,f;for(c=this.items.length-1;c>=0;c--)d=this.items[c],d.instance!==this.currentContainer&&this.currentContainer&&d.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item,b||(d.width=e.outerWidth(),d.height=e.outerHeight()),f=e.offset(),d.left=f.left,d.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){b=b||this;var c,d=b.options;d.placeholder&&d.placeholder.constructor!==String||(c=d.placeholder,d.placeholder={element:function(){var d=b.currentItem[0].nodeName.toLowerCase(),e=a("<"+d+">",b.document[0]).addClass(c||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===d?b.currentItem.children().each(function(){a("<td>&#160;</td>",b.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(e)}):"img"===d&&e.attr("src",b.currentItem.attr("src")),c||e.css("visibility","hidden"),e},update:function(a,e){(!c||d.forcePlaceholderSize)&&(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}),b.placeholder=a(d.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),d.placeholder.update(b,b.placeholder)},_contactContainers:function(d){var e,f,g,h,i,j,k,l,m,n,o=null,p=null;for(e=this.containers.length-1;e>=0;e--)if(!a.contains(this.currentItem[0],this.containers[e].element[0]))if(this._intersectsWith(this.containers[e].containerCache)){if(o&&a.contains(this.containers[e].element[0],o.element[0]))continue;o=this.containers[e],p=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",d,this._uiHash(this)),this.containers[e].containerCache.over=0);if(o)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",d,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(g=1e4,h=null,n=o.floating||c(this.currentItem),i=n?"left":"top",j=n?"width":"height",k=this.positionAbs[i]+this.offset.click[i],f=this.items.length-1;f>=0;f--)a.contains(this.containers[p].element[0],this.items[f].item[0])&&this.items[f].item[0]!==this.currentItem[0]&&(!n||b(this.positionAbs.top+this.offset.click.top,this.items[f].top,this.items[f].height))&&(l=this.items[f].item.offset()[i],m=!1,Math.abs(l-k)>Math.abs(l+this.items[f][j]-k)&&(m=!0,l+=this.items[f][j]),Math.abs(l-k)<g&&(g=Math.abs(l-k),h=this.items[f],this.direction=m?"up":"down"));if(!h&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return;h?this._rearrange(d,h,null,!0):this._rearrange(d,null,this.containers[p].element,!0),this._trigger("change",d,this._uiHash()),this.containers[p]._trigger("change",d,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",d,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"===c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!==c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!d[0].style.width||c.forceHelperSize)&&d.width(this.currentItem.width()),(!d[0].style.height||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),("document"===e.containment||"window"===e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"===e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e=this.options,f=b.pageX,g=b.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),e.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-e.grid[1]:c+e.grid[1]:c,d=this.originalPageX+Math.round((f-this.originalPageX)/e.grid[0])*e.grid[0],f=this.containment?d-this.offset.click.left>=this.containment[0]&&d-this.offset.click.left<=this.containment[2]?d:d-this.offset.click.left>=this.containment[0]?d-e.grid[0]:d+e.grid[0]:d)),{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){function c(a,b,c){return function(d){c._trigger(a,d,b._uiHash(b))}}this.reverting=!1;var d,e=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(d in this._storedCSS)("auto"===this._storedCSS[d]||"static"===this._storedCSS[d])&&(this._storedCSS[d]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!b&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||b||e.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(b||(e.push(function(a){this._trigger("remove",a,this._uiHash())}),e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)))),d=this.containers.length-1;d>=0;d--)b||e.push(c("deactivate",this,this.containers[d])),this.containers[d].containerCache.over&&(e.push(c("out",this,this.containers[d])),this.containers[d].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!b){for(this._trigger("beforeStop",a,this._uiHash()),d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!1}if(b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!b){for(d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}(jQuery),angular.module("ui.config",[]).value("ui.config",{}),angular.module("ui.filters",["ui.config"]),angular.module("ui.directives",["ui.config"]),angular.module("ui",["ui.filters","ui.directives","ui.config"]),angular.module("ui.directives").directive("uiAnimate",["ui.config","$timeout",function(a,b){var c={};return angular.isString(a.animate)?c["class"]=a.animate:a.animate&&(c=a.animate),{restrict:"A",link:function(a,d,e){var f={};e.uiAnimate&&(f=a.$eval(e.uiAnimate),angular.isString(f)&&(f={"class":f})),f=angular.extend({"class":"ui-animate"},c,f),d.addClass(f["class"]),b(function(){d.removeClass(f["class"])},20,!1)}}}]),angular.module("ui.directives").directive("uiCalendar",["ui.config","$parse",function(a){return a.uiCalendar=a.uiCalendar||{},{require:"ngModel",restrict:"A",link:function(b,c,d){function e(){b.calendar=c.html("");var e=b.calendar.fullCalendar("getView");e&&(e=e.name);var g,h={defaultView:e,eventSources:f};g=d.uiCalendar?b.$eval(d.uiCalendar):{},angular.extend(h,a.uiCalendar,g),b.calendar.fullCalendar(h)}var f=b.$eval(d.ngModel),g=0,h=function(){var a=b.$eval(d.equalsTracker);return g=0,angular.forEach(f,function(a){angular.isArray(a)&&(g+=a.length)}),angular.isNumber(a)?g+f.length+a:g+f.length};e(),b.$watch(h,function(){e()})}}}]),angular.module("ui.directives").directive("uiCodemirror",["ui.config","$timeout",function(a,b){"use strict";var c=["cursorActivity","viewportChange","gutterClick","focus","blur","scroll","update"];return{restrict:"A",require:"ngModel",link:function(d,e,f,g){var h,i,j,k,l;if("textarea"!==e[0].type)throw new Error("uiCodemirror3 can only be applied to a textarea element");h=a.codemirror||{},i=angular.extend({},h,d.$eval(f.uiCodemirror)),j=function(a){return function(b,c){var e=b.getValue();e!==g.$viewValue&&(g.$setViewValue(e),d.$apply()),"function"==typeof a&&a(b,c)}},k=function(){l=CodeMirror.fromTextArea(e[0],i),l.on("change",j(i.onChange));for(var a,h=0,k=c.length;k>h;++h)a=i["on"+c[h].charAt(0).toUpperCase()+c[h].slice(1)],void 0!==a&&"function"==typeof a&&l.on(c[h],a);g.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-codemirror cannot use an object or an array as a model");return a}),g.$render=function(){l.setValue(g.$viewValue)},f.uiRefresh&&d.$watch(f.uiRefresh,function(a,c){a!==c&&b(l.refresh)})},b(k)}}}]),angular.module("ui.directives").directive("uiCurrency",["ui.config","currencyFilter",function(a,b){var c={pos:"ui-currency-pos",neg:"ui-currency-neg",zero:"ui-currency-zero"};return a.currency&&angular.extend(c,a.currency),{restrict:"EAC",require:"ngModel",link:function(a,d,e,f){var g,h,i;g=angular.extend({},c,a.$eval(e.uiCurrency)),h=function(a){var c;return c=1*a,d.toggleClass(g.pos,c>0),d.toggleClass(g.neg,0>c),d.toggleClass(g.zero,0===c),d.text(""===a?"":b(c,g.symbol)),!0},f.$render=function(){i=f.$viewValue,d.val(i),h(i)}}}}]),angular.module("ui.directives").directive("uiDate",["ui.config",function(a){"use strict";var b;return b={},angular.isObject(a.date)&&angular.extend(b,a.date),{require:"?ngModel",link:function(b,c,d,e){var f=function(){return angular.extend({},a.date,b.$eval(d.uiDate))},g=function(){var a=f();if(e){var d=function(){b.$apply(function(){var a=c.datepicker("getDate");c.datepicker("setDate",c.val()),e.$setViewValue(a),c.blur()})};if(a.onSelect){var g=a.onSelect;a.onSelect=function(a,c){d(),b.$apply(function(){g(a,c)})}}else a.onSelect=d;c.bind("change",d),e.$render=function(){var a=e.$viewValue;if(angular.isDefined(a)&&null!==a&&!angular.isDate(a))throw new Error("ng-Model value must be a Date object - currently it is a "+typeof a+" - use ui-date-format to convert it from a string");c.datepicker("setDate",a)}}c.datepicker("destroy"),c.datepicker(a),e&&e.$render()};b.$watch(f,g,!0)}}}]).directive("uiDateFormat",["ui.config",function(a){var b={require:"ngModel",link:function(b,c,d,e){var f=d.uiDateFormat||a.dateFormat;f?(e.$formatters.push(function(a){return angular.isString(a)?$.datepicker.parseDate(f,a):void 0}),e.$parsers.push(function(a){return a?$.datepicker.formatDate(f,a):void 0})):(e.$formatters.push(function(a){return angular.isString(a)?new Date(a):void 0}),e.$parsers.push(function(a){return a?a.toISOString():void 0}))}};return b}]),angular.module("ui.directives").directive("uiEvent",["$parse",function(a){return function(b,c,d){var e=b.$eval(d.uiEvent);angular.forEach(e,function(d,e){var f=a(d);c.bind(e,function(a){var c=Array.prototype.slice.call(arguments);c=c.splice(1),b.$apply(function(){f(b,{$event:a,$params:c})})})})}}]),angular.module("ui.directives").directive("uiIf",[function(){return{transclude:"element",priority:1e3,terminal:!0,restrict:"A",compile:function(a,b,c){return function(a,b,d){var e,f;a.$watch(d.uiIf,function(d){e&&(e.remove(),e=void 0),f&&(f.$destroy(),f=void 0),d&&(f=a.$new(),c(f,function(a){e=a,b.after(a)}))})}}}}]),angular.module("ui.directives").directive("uiJq",["ui.config","$timeout",function(a,b){return{restrict:"A",compile:function(c,d){if(!angular.isFunction(c[d.uiJq]))throw new Error('ui-jq: The "'+d.uiJq+'" function does not exist');var e=a.jq&&a.jq[d.uiJq];return function(a,c,d){function f(){b(function(){c[d.uiJq].apply(c,g)},0,!1)}var g=[];d.uiOptions?(g=a.$eval("["+d.uiOptions+"]"),angular.isObject(e)&&angular.isObject(g[0])&&(g[0]=angular.extend({},e,g[0]))):e&&(g=[e]),d.ngModel&&c.is("select,input,textarea")&&c.on("change",function(){c.trigger("input")}),d.uiRefresh&&a.$watch(d.uiRefresh,function(){f()}),f()}}}}]),angular.module("ui.directives").factory("keypressHelper",["$parse",function(a){var b={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete"},c=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};return function(d,e,f,g){var h,i=[];h=e.$eval(g["ui"+c(d)]),angular.forEach(h,function(b,c){var d,e;e=a(b),angular.forEach(c.split(" "),function(a){d={expression:e,keys:{}},angular.forEach(a.split("-"),function(a){d.keys[a]=!0}),i.push(d)})}),f.bind(d,function(a){var c=a.metaKey||a.altKey,f=a.ctrlKey,g=a.shiftKey,h=a.keyCode;"keypress"===d&&!g&&h>=97&&122>=h&&(h-=32),angular.forEach(i,function(d){var h=d.keys[b[a.keyCode]]||d.keys[a.keyCode.toString()]||!1,i=d.keys.alt||!1,j=d.keys.ctrl||!1,k=d.keys.shift||!1;h&&i==c&&j==f&&k==g&&e.$apply(function(){d.expression(e,{$event:a})})})})}}]),angular.module("ui.directives").directive("uiKeydown",["keypressHelper",function(a){return{link:function(b,c,d){a("keydown",b,c,d)}}}]),angular.module("ui.directives").directive("uiKeypress",["keypressHelper",function(a){return{link:function(b,c,d){a("keypress",b,c,d)}}}]),angular.module("ui.directives").directive("uiKeyup",["keypressHelper",function(a){return{link:function(b,c,d){a("keyup",b,c,d)}}}]),function(){function a(a,b,c,d){angular.forEach(b.split(" "),function(b){var e={type:"map-"+b};google.maps.event.addListener(c,b,function(b){d.triggerHandler(angular.extend({},e,b)),a.$$phase||a.$apply()})})}function b(b,d){c.directive(b,[function(){return{restrict:"A",link:function(c,e,f){c.$watch(f[b],function(b){a(c,d,b,e)})}}}])}var c=angular.module("ui.directives");c.directive("uiMap",["ui.config","$parse",function(b,c){var d="bounds_changed center_changed click dblclick drag dragend dragstart heading_changed idle maptypeid_changed mousemove mouseout mouseover projection_changed resize rightclick tilesloaded tilt_changed zoom_changed",e=b.map||{};return{restrict:"A",link:function(b,f,g){var h=angular.extend({},e,b.$eval(g.uiOptions)),i=new google.maps.Map(f[0],h),j=c(g.uiMap);j.assign(b,i),a(b,d,i,f)}}}]),c.directive("uiMapInfoWindow",["ui.config","$parse","$compile",function(b,c,d){var e="closeclick content_change domready position_changed zindex_changed",f=b.mapInfoWindow||{};return{link:function(b,g,h){var i=angular.extend({},f,b.$eval(h.uiOptions));i.content=g[0];var j=c(h.uiMapInfoWindow),k=j(b);k||(k=new google.maps.InfoWindow(i),j.assign(b,k)),a(b,e,k,g),g.replaceWith("<div></div>");
var l=k.open;k.open=function(a,c,e,f,h,i){d(g.contents())(b),l.call(k,a,c,e,f,h,i)}}}}]),b("uiMapMarker","animation_changed click clickable_changed cursor_changed dblclick drag dragend draggable_changed dragstart flat_changed icon_changed mousedown mouseout mouseover mouseup position_changed rightclick shadow_changed shape_changed title_changed visible_changed zindex_changed"),b("uiMapPolyline","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapPolygon","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapRectangle","bounds_changed click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapCircle","center_changed click dblclick mousedown mousemove mouseout mouseover mouseup radius_changed rightclick"),b("uiMapGroundOverlay","click dblclick")}(),angular.module("ui.directives").directive("uiMask",[function(){return{require:"ngModel",link:function(a,b,c,d){d.$render=function(){var e=d.$viewValue||"";b.val(e),b.mask(a.$eval(c.uiMask))},d.$parsers.push(function(a){var c=b.isMaskValid()||angular.isUndefined(b.isMaskValid())&&b.val().length>0;return d.$setValidity("mask",c),c?a:void 0}),b.bind("keyup",function(){a.$apply(function(){d.$setViewValue(b.mask())})})}}}]),angular.module("ui.directives").directive("uiReset",["ui.config",function(a){var b=null;return void 0!==a.reset&&(b=a.reset),{require:"ngModel",link:function(a,c,d,e){var f;f=angular.element('<a class="ui-reset" />'),c.wrap('<span class="ui-resetwrap" />').after(f),f.bind("click",function(c){c.preventDefault(),a.$apply(function(){e.$setViewValue(d.uiReset?a.$eval(d.uiReset):b),e.$render()})})}}}]),angular.module("ui.directives").directive("uiRoute",["$location","$parse",function(a,b){return{restrict:"AC",compile:function(c,d){var e;if(d.uiRoute)e="uiRoute";else if(d.ngHref)e="ngHref";else{if(!d.href)throw new Error("uiRoute missing a route or href property on "+c[0]);e="href"}return function(c,d,f){function g(b){(hash=b.indexOf("#"))>-1&&(b=b.substr(hash+1)),(j=function(){i(c,a.path().indexOf(b)>-1)})()}function h(b){(hash=b.indexOf("#"))>-1&&(b=b.substr(hash+1)),(j=function(){var d=new RegExp("^"+b+"$",["i"]);i(c,d.test(a.path()))})()}var i=b(f.ngModel||f.routeModel||"$uiRoute").assign,j=angular.noop;switch(e){case"uiRoute":f.uiRoute?h(f.uiRoute):f.$observe("uiRoute",h);break;case"ngHref":f.ngHref?g(f.ngHref):f.$observe("ngHref",g);break;case"href":g(f.href)}c.$on("$routeChangeSuccess",function(){j()})}}}}]),angular.module("ui.directives").directive("uiScrollfix",["$window",function(a){"use strict";return{link:function(b,c,d){var e=c.offset().top;d.uiScrollfix?"-"===d.uiScrollfix.charAt(0)?d.uiScrollfix=e-d.uiScrollfix.substr(1):"+"===d.uiScrollfix.charAt(0)&&(d.uiScrollfix=e+parseFloat(d.uiScrollfix.substr(1))):d.uiScrollfix=e,angular.element(a).on("scroll.ui-scrollfix",function(){var b;if(angular.isDefined(a.pageYOffset))b=a.pageYOffset;else{var e=document.compatMode&&"BackCompat"!==document.compatMode?document.documentElement:document.body;b=e.scrollTop}!c.hasClass("ui-scrollfix")&&b>d.uiScrollfix?c.addClass("ui-scrollfix"):c.hasClass("ui-scrollfix")&&b<d.uiScrollfix&&c.removeClass("ui-scrollfix")})}}}]),angular.module("ui.directives").directive("uiSelect2",["ui.config","$timeout",function(a,b){var c={};return a.select2&&angular.extend(c,a.select2),{require:"?ngModel",compile:function(a,d){var e,f,g,h=a.is("select"),i=void 0!==d.multiple;return a.is("select")&&(f=a.find("option[ng-repeat], option[data-ng-repeat]"),f.length&&(g=f.attr("ng-repeat")||f.attr("data-ng-repeat"),e=jQuery.trim(g.split("|")[0]).split(" ").pop())),function(a,d,f,g){var j=angular.extend({},c,a.$eval(f.uiSelect2));if(h?(delete j.multiple,delete j.initSelection):i&&(j.multiple=!0),g&&(g.$render=function(){h?d.select2("val",g.$modelValue):i?g.$modelValue?angular.isArray(g.$modelValue)?d.select2("data",g.$modelValue):d.select2("val",g.$modelValue):d.select2("data",[]):angular.isObject(g.$modelValue)?d.select2("data",g.$modelValue):d.select2("val",g.$modelValue)},e&&a.$watch(e,function(a){a&&b(function(){d.select2("val",g.$viewValue),d.trigger("change")})}),!h&&(d.bind("change",function(){a.$apply(function(){g.$setViewValue(d.select2("data"))})}),j.initSelection))){var k=j.initSelection;j.initSelection=function(a,b){k(a,function(a){g.$setViewValue(a),b(a)})}}f.$observe("disabled",function(a){d.select2(a&&"disable"||"enable")}),f.ngMultiple&&a.$watch(f.ngMultiple,function(){d.select2(j)}),d.val(a.$eval(f.ngModel)),b(function(){d.select2(j),j.initSelection||h||g.$setViewValue(d.select2("data"))})}}}}]),angular.module("ui.directives").directive("uiShow",[function(){return function(a,b,c){a.$watch(c.uiShow,function(a){a?b.addClass("ui-show"):b.removeClass("ui-show")})}}]).directive("uiHide",[function(){return function(a,b,c){a.$watch(c.uiHide,function(a){a?b.addClass("ui-hide"):b.removeClass("ui-hide")})}}]).directive("uiToggle",[function(){return function(a,b,c){a.$watch(c.uiToggle,function(a){a?b.removeClass("ui-hide").addClass("ui-show"):b.removeClass("ui-show").addClass("ui-hide")})}}]),angular.module("ui.directives").directive("uiSortable",["ui.config",function(a){return{require:"?ngModel",link:function(b,c,d,e){var f,g,h,i,j,k,l,m,n;j=angular.extend({},a.sortable,b.$eval(d.uiSortable)),e&&(e.$render=function(){c.sortable("refresh")},h=function(a,b){b.item.sortable={index:b.item.index()}},i=function(a,b){b.item.sortable.resort=e},f=function(a,b){b.item.sortable.relocate=!0,e.$modelValue.splice(b.item.index(),0,b.item.sortable.moved)},g=function(a,b){b.item.sortable.moved=1===e.$modelValue.length?e.$modelValue.splice(0,1)[0]:e.$modelValue.splice(b.item.sortable.index,1)[0]},onStop=function(a,c){if(c.item.sortable.resort&&!c.item.sortable.relocate){var d,e;e=c.item.sortable.index,d=c.item.index(),d>e&&d--,c.item.sortable.resort.$modelValue.splice(d,0,c.item.sortable.resort.$modelValue.splice(e,1)[0])}(c.item.sortable.resort||c.item.sortable.relocate)&&b.$apply()},m=j.start,j.start=function(a,b){h(a,b),"function"==typeof m&&m(a,b)},_stop=j.stop,j.stop=function(a,b){onStop(a,b),"function"==typeof _stop&&_stop(a,b)},n=j.update,j.update=function(a,b){i(a,b),"function"==typeof n&&n(a,b)},k=j.receive,j.receive=function(a,b){f(a,b),"function"==typeof k&&k(a,b)},l=j.remove,j.remove=function(a,b){g(a,b),"function"==typeof l&&l(a,b)}),c.sortable(j)}}}]),angular.module("ui.directives").directive("uiTinymce",["ui.config",function(a){return a.tinymce=a.tinymce||{},{require:"ngModel",link:function(b,c,d,e){var f,g={onchange_callback:function(a){a.isDirty()&&(a.save(),e.$setViewValue(c.val()),b.$$phase||b.$apply())},handle_event_callback:function(){return this.isDirty()&&(this.save(),e.$setViewValue(c.val()),b.$$phase||b.$apply()),!0},setup:function(a){a.onSetContent.add(function(a){a.isDirty()&&(a.save(),e.$setViewValue(c.val()),b.$$phase||b.$apply())})}};f=d.uiTinymce?b.$eval(d.uiTinymce):{},angular.extend(g,a.tinymce,f),setTimeout(function(){c.tinymce(g)})}}}]),angular.module("ui.directives").directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e,f,g={},h=a.$eval(c.uiValidate);h&&(angular.isString(h)&&(h={validator:h}),angular.forEach(h,function(b,c){e=function(e){return a.$eval(b,{$value:e})?(d.$setValidity(c,!0),e):void d.$setValidity(c,!1)},g[c]=e,d.$formatters.push(e),d.$parsers.push(e)}),c.uiValidateWatch&&(f=a.$eval(c.uiValidateWatch),angular.isString(f)?a.$watch(f,function(){angular.forEach(g,function(a){a(d.$modelValue)})}):angular.forEach(f,function(b,c){a.$watch(b,function(){g[c](d.$modelValue)})})))}}}),angular.module("ui.filters").filter("format",function(){return function(a,b){if(!a)return a;var c,d=a.toString();return void 0===b?d:angular.isArray(b)||angular.isObject(b)?(c=angular.isArray(b)&&"$"||":",angular.forEach(b,function(a,b){d=d.split(c+b).join(a)}),d):d.split("$0").join(b)}}),angular.module("ui.filters").filter("highlight",function(){return function(a,b,c){return b||angular.isNumber(b)?(a=a.toString(),b=b.toString(),c?a.split(b).join('<span class="ui-match">'+b+"</span>"):a.replace(new RegExp(b,"gi"),'<span class="ui-match">$&</span>')):a}}),angular.module("ui.filters").filter("inflector",function(){function a(a){return a.replace(/^([a-z])|\s+([a-z])/g,function(a){return a.toUpperCase()})}function b(a,b){return a.replace(/[A-Z]/g,function(a){return b+a})}var c={humanize:function(c){return a(b(c," ").split("_").join(" "))},underscore:function(a){return a.substr(0,1).toLowerCase()+b(a.substr(1),"_").toLowerCase().split(" ").join("_")},variable:function(b){return b=b.substr(0,1).toLowerCase()+a(b.split("_").join(" ")).substr(1).split(" ").join("")}};return function(a,b){return b!==!1&&angular.isString(a)?(b=b||"humanize",c[b](a)):a}}),angular.module("ui.filters").filter("unique",function(){return function(a,b){if(b===!1)return a;if((b||angular.isUndefined(b))&&angular.isArray(a)){var c=[],d=function(a){return angular.isObject(a)&&angular.isString(b)?a[b]:a};angular.forEach(a,function(a){for(var b=!1,e=0;e<c.length;e++)if(angular.equals(d(c[e]),d(a))){b=!0;break}b||c.push(a)}),a=c}return a}}),angular.module("ui.directives").directive("uiSortable",["ui.config",function(a){return{require:"?ngModel",link:function(b,c,d,e){var f,g,h,i,j,k,l,m,n;j=angular.extend({},a.sortable,b.$eval(d.uiSortable)),e&&(e.$render=function(){c.sortable("refresh")},h=function(a,b){b.item.sortable={index:b.item.index()}},i=function(a,b){b.item.sortable.resort=e},f=function(a,b){b.item.sortable.relocate=!0,e.$modelValue.splice(b.item.index(),0,b.item.sortable.moved)},g=function(a,b){b.item.sortable.moved=1===e.$modelValue.length?e.$modelValue.splice(0,1)[0]:e.$modelValue.splice(b.item.sortable.index,1)[0]},onStop=function(a,c){if(c.item.sortable.resort&&!c.item.sortable.relocate){var d,e;e=c.item.sortable.index,d=c.item.index(),d>e&&d--,c.item.sortable.resort.$modelValue.splice(d,0,c.item.sortable.resort.$modelValue.splice(e,1)[0])}(c.item.sortable.resort||c.item.sortable.relocate)&&b.$apply()},m=j.start,j.start=function(a,b){h(a,b),"function"==typeof m&&m(a,b)},_stop=j.stop,j.stop=function(a,b){onStop(a,b),"function"==typeof _stop&&_stop(a,b)},n=j.update,j.update=function(a,b){i(a,b),"function"==typeof n&&n(a,b)},k=j.receive,j.receive=function(a,b){f(a,b),"function"==typeof k&&k(a,b)},l=j.remove,j.remove=function(a,b){g(a,b),"function"==typeof l&&l(a,b)}),c.sortable(j)}}}]),angular.module("commonsCloudAdminApp",["ivpusic.cookie","ngResource","ngSanitize","ngRoute","ngAnimate","ui.gravatar","ui.directives","leaflet-directive"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"/views/main.html",controller:"MainCtrl"}).when("/authorize",{templateUrl:"/views/authorize.html",controller:"AuthorizeCtrl"}).when("/applications",{templateUrl:"/views/applications.html",controller:"ApplicationsCtrl"}).when("/applications/:applicationId",{templateUrl:"/views/applicationsingle.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates",{redirectTo:"/applications/:applicationId"}).when("/applications/:applicationId/collaborators",{templateUrl:"/views/collaborators.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates/:templateId/features",{templateUrl:"/views/templatessingle.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates/:templateId/features/add",{templateUrl:"/views/addfeatures.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates/:templateId/features/:featureId",{templateUrl:"/views/editfeature.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates/:templateId",{redirectTo:"/applications/:applicationId/templates/:templateId/features"}).when("/applications/:applicationId/templates/:templateId/statistics",{templateUrl:"/views/statistics.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates/:templateId/statistics/add",{templateUrl:"/views/addstatistics.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates/:templateId/statistics/:statisticId",{templateUrl:"/views/editstatistics.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates/:templateId/fields",{templateUrl:"/views/fields.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates/:templateId/settings",{templateUrl:"/views/settings.html",controller:"ApplicationSingleCtrl"}).when("/applications/:applicationId/templates/:templateId/developers",{templateUrl:"/views/developers.html",controller:"ApplicationSingleCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!0).hashPrefix("!")}]),angular.module("commonsCloudAdminApp").controller("MainCtrl",["$rootScope","$scope",function(){}]),angular.module("commonsCloudAdminApp").controller("AuthorizeCtrl",["$scope","$rootScope","$location","ipCookie",function(a,b,c,d){a.getAccessToken=function(){var a=c.hash(),e=a.substring(0,a.indexOf("&")),f=e.replace("access_token=",""),g={expires:2};return b.user.is_authenticated=!0,d("session",f,g)},a.getAccessToken(),c.hash(""),c.path("/applications")}]),angular.module("commonsCloudAdminApp").factory("AuthorizationInterceptor",["$rootScope","$q","ipCookie","$location",function(a,b,c,d){return a.user={is_authenticated:!1},{request:function(a){var e=c("session");return"/views/authorize.html"===a.url||"undefined"!==e&&void 0!==e?(a.headers=a.headers||{},e&&(a.headers.Authorization="Bearer "+e),a.headers["Content-Type"]="application/json",console.debug("AuthorizationInterceptor::Request",a||b.when(a)),a||b.when(a)):(d.hash(""),d.path("/"),a||b.when(a))},response:function(a){return 401===a.status||403===a.status?(d.hash(""),d.path("/"),a||b.when(a)):(console.debug("AuthorizationInterceptor::Response",a||b.when(a)),a||b.when(a))}}}]).config(function(a){a.interceptors.push("AuthorizationInterceptor")}),angular.module("commonsCloudAdminApp").controller("ApplicationsCtrl",["$rootScope","$scope","$route","Application","User","ipCookie","$location",function(a,b,c,d,e){b.application=new d,b.applications=d.query(),a.navigation=!1,b.NewApplication=!1,b.GetUser=function(){e.get().$promise.then(function(a){b.user=a.response,console.log("User",b.user)})},b.GetUser(),b.save=function(){console.log(b.application),b.application.$save().then(function(a){b.applications.push(a.response)}),b.application=new d,b.NewApplication=!1}}]),angular.module("commonsCloudAdminApp").factory("CommonsCloudAPI",["$http",function(){return{getApplications:function(){return!0}}}]),angular.module("commonsCloudAdminApp").provider("Application",function(){this.$get=["$resource","$location",function(a){var b="//api.commonscloud.org/v2/applications/:id.json",c=a(b,{},{query:{method:"GET",isArray:!0,transformResponse:function(a){var b=angular.fromJson(a);return b.response.applications}},update:{method:"PATCH"}});return c}]}),angular.module("commonsCloudAdminApp").controller("ApplicationSingleCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","Application","Template","Feature","Field","Statistic","User","leafletData",function(a,b,c,d,e,f,g,h,i,j,k,l){b.application={},b.templates=[],b.template={},b.fields=[],b.field={},b.features=[],b.statistics=[],b.statistic={},b.newTemplate=new g,b.newField=new i,b.newStatistic=new j,b.feature=new h,b.user=new k,b.loading=!0,b.alerts=[],a.navigation=!1,b.EditApplication=!1,b.AddTemplate=!1,b.orderByField=null,b.reverseSort=!1,b.FieldEdit=!1,b.FieldAdd=!1,b.ShowMap=!0,b.ShowGeoJSONEditor=!1,b.MapLoaded=!1,b.GetUser=function(){k.get().$promise.then(function(a){b.user=a.response,console.log("User",b.user)})},b.GetTemplateList=function(){g.query({applicationId:c.applicationId}).$promise.then(function(a){b.templates=a,angular.forEach(b.templates,function(a,c){b.templates[c].features=[],h.query({storage:a.storage}).$promise.then(function(a){b.templates[c].features=a}),h.query({storage:a.storage,q:{filters:[{name:"status",op:"eq",val:"crowd"}]}}).$promise.then(function(a){b.templates[c].moderation=a,b.templates[c].moderation.properties.total_features>0&&(b.templates[c].moderation=!0)})})})},b.GetTemplate=function(){g.get({id:c.templateId}).$promise.then(function(a){b.template=a.response,b.loading=!1,c.page?h.query({storage:b.template.storage,page:c.page}).$promise.then(function(a){b.featureproperties=a.properties,b.features=a.response.features}):h.query({storage:b.template.storage}).$promise.then(function(a){b.featureproperties=a.properties,b.features=a.response.features}),i.query({templateId:b.template.id}).$promise.then(function(a){b.fields=a,b.getEnumeratedValues(b.fields),c.featureId&&h.get({storage:b.template.storage,featureId:c.featureId}).$promise.then(function(a){b.feature=a}),b.getEditableMap()}),j.query({templateId:b.template.id}).$promise.then(function(a){b.statistics=a})})},b.GetApplicationPage=function(){b.GetUser(),b.GetTemplateList(),c.templateId&&b.GetTemplate(),c.statisticId&&b.GetStatistic()},b.GetApplication=function(){f.get({id:c.applicationId}).$promise.then(function(a){b.application=a.response,b.loading=!1,b.GetApplicationPage()})},b.UpdateApplication=function(){b.application.id&&(b.EditApplication=!1,f.update({id:b.application.id},b.application))},b.DeleteApplication=function(a){var b={id:a.id};f.delete(b),d.path("/applications")},b.CreateTemplate=function(){b.newTemplate.$save({applicationId:b.application.id}).then(function(a){b.templates.push(a.response)})},b.UpdateTemplate=function(){g.update({id:b.template.id},b.template);var a={type:"success",title:"Updated",details:"Your template updates were saved successfully!"};b.alerts.push(a),e(function(){b.alerts=[]},3e3)},b.DeleteTemplate=function(a){var c={id:a.id};g.delete(c),d.path("/applications/"+b.application.id+"/templates")},b.CreateField=function(){b.newField.$save({templateId:b.template.id}).then(function(a){b.fields.push(a.response)})},b.ActionEditField=function(a){b.editField=a,b.FieldEdit=!0,b.FieldAdd=!1},b.UpdateField=function(){i.update({templateId:b.template.id,fieldId:b.editField.id},b.editField);var a={type:"success",title:"Updated",details:"Your field updates were saved successfully!"};b.alerts.push(a),e(function(){b.alerts=[]},3e3),b.editField={},b.FieldEdit=!1,b.FieldAdd=!0},b.DeleteField=function(a){var c={templateId:b.template.id,fieldId:a.id};i.delete(c),b.fields.pop(a),b.editField={},b.FieldEdit=!1,b.fields.length&&(b.FieldAdd=!0)},b.CreateFeature=function(){b.feature.geometry&&(b.feature.geometry=b.convertFeatureCollectionToGeometryCollection(b.feature.geometry)),b.feature.$save({storage:b.template.storage}).then(function(){l.unresolveMap(),d.path("/applications/"+b.application.id+"/templates/"+b.template.id+"/features")})},b.UpdateFeature=function(){h.update({storage:b.template.storage,featureId:b.feature.id},b.feature);var a={type:"success",title:"Updated",details:"Your feature updates were saved successfully!"};b.alerts.push(a),e(function(){b.alerts=[]},3e3)},b.DeleteFeature=function(a){console.log("$scope.template",b.template);var c={storage:b.template.storage,featureId:a.id};h.delete(c),b.features.pop(a),d.path("/applications/"+b.application.id+"/templates/"+b.template.id+"/features")},b.GetStatistic=function(){j.get({templateId:c.templateId,statisticId:c.statisticId}).$promise.then(function(a){b.statistic=a})},b.CreateStatistic=function(){b.newStatistic.$save({templateId:c.templateId}).then(function(){d.path("/applications/"+b.application.id+"/templates/"+b.template.id+"/statistics")})},b.UpdateStatistic=function(a){j.update({templateId:b.template.id,statisticId:a.id},a);var c={type:"success",title:"Updated",details:"We saved the updates you made to your statistic!"};b.alerts.push(c),e(function(){b.alerts=[]},3e3)},b.DeleteStatistic=function(a){var c={templateId:b.template.id,statisticId:a.id};j.delete(c),b.statistics.pop(a),d.path("/applications/"+b.application.id+"/templates/"+b.template.id+"/statistics")},b.getEditableMap=function(){},b.getEnumeratedValues=function(a){angular.forEach(a,function(a,c){"relationship"===a.data_type&&h.query({storage:a.relationship}).$promise.then(function(a){b.fields[c].values=a.response.features})})},b.ChangeOrder=function(a){b.orderByField=a,b.reverseSort=!b.reverseSort},b.convertFeatureCollectionToGeometryCollection=function(a){var b=angular.fromJson(a),c={type:"GeometryCollection",geometries:[]};return angular.forEach(b.features,function(a){c.geometries.push(a.geometry)}),c},b.GetApplication()}]),angular.module("commonsCloudAdminApp").provider("Template",function(){this.$get=["$resource",function(a){var b=a("//api.commonscloud.org/v2/templates/:id.json",{},{query:{method:"GET",isArray:!0,url:"//api.commonscloud.org/v2/applications/:applicationId/templates.json",transformResponse:function(a){var b=angular.fromJson(a);return b.response.templates}},save:{method:"POST",url:"//api.commonscloud.org/v2/applications/:applicationId/templates.json"},update:{method:"PATCH"}});return b}]}),angular.module("commonsCloudAdminApp").provider("Feature",function(){this.$get=["$resource",function(a){var b=a("//api.commonscloud.org/v2/:storage.json",{},{query:{method:"GET",isArray:!1,transformResponse:function(a){return angular.fromJson(a)}},save:{method:"POST",transformRequest:function(a){var b=angular.fromJson(a);return b.geometry=angular.fromJson(b.geometry),a=angular.toJson(b)}},get:{method:"GET",url:"//api.commonscloud.org/v2/:storage/:featureId.json",transformResponse:function(a){var b=angular.fromJson(a);return b.response}},update:{method:"PATCH",url:"//api.commonscloud.org/v2/:storage/:featureId.json",transformRequest:function(a){var b=angular.fromJson(a);return b.geometry=angular.fromJson(b.geometry),console.log(angular.toJson(b)),b}},"delete":{method:"DELETE",url:"//api.commonscloud.org/v2/:storage/:featureId.json"}});return b}]}),angular.module("commonsCloudAdminApp").provider("Field",function(){this.$get=["$resource",function(a){var b=a("//api.commonscloud.org/v2/templates/:templateId/fields/:fieldId.json",{},{query:{method:"GET",isArray:!0,url:"//api.commonscloud.org/v2/templates/:templateId/fields.json",transformResponse:function(a){var b=angular.fromJson(a);return b.response.fields}},save:{method:"POST",url:"//api.commonscloud.org/v2/templates/:templateId/fields.json"},update:{method:"PATCH"}});return b}]}),angular.module("commonsCloudAdminApp").provider("Statistic",function(){this.$get=["$resource",function(a){var b=a("//api.commonscloud.org/v2/templates/:templateId/statistics/:statisticId.json",{},{get:{method:"GET",transformResponse:function(a){var b=angular.fromJson(a);return b.response}},query:{method:"GET",isArray:!0,url:"//api.commonscloud.org/v2/templates/:templateId/statistics.json",transformResponse:function(a){var b=angular.fromJson(a);return b.response.statistics}},save:{method:"POST",url:"//api.commonscloud.org/v2/templates/:templateId/statistics.json"},update:{method:"PATCH"}});return b}]}),angular.module("commonsCloudAdminApp").provider("User",function(){this.$get=["$resource",function(a){var b=a("//api.commonscloud.org/v2/user/me.json");return b}]});